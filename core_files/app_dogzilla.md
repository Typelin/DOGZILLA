# DOGZILLA 主控程式技術手冊 (app_dogzilla.py)

本程式是 DOGZILLA 機器狗的「大腦」，負責處理網路通訊、解析控制指令、串流攝像頭影像以及管理硬體動作。

## 一、 程式概述
* **檔案名稱**：`app_dogzilla.py`
* **軟體版本**：V2.0.7
* **核心框架**：基於 Flask 與 Socket 的多執行緒架構

## 二、 依賴庫與模組引用
程式引用了多個關鍵模組來實現功能：
1.  **系統級模組**：`socket`, `os`, `threading`, `time`, `sys`（負責通訊與執行緒管理）。
2.  **Web 框架**：`flask`, `gevent.pywsgi`（負責網頁介面與視訊串流）。
3.  **影像處理**：`cv2` (OpenCV)（負責攝像頭影像擷取與 FPS 標註）。
4.  **機器人核心庫**：`DOGZILLALib`（Yahboom 官方底層驅動庫）。
5.  **專屬硬體模組**：
    * `camera_dogzilla`：攝像頭控制。
    * `joystick_dogzilla`：USB 無線手柄處理。
    * `oled_dogzilla`：OLED 顯示器接口。

## 三、 功能章節
### 3.1 網路通訊中心
* **TCP Server (Port 6000)**：主要的控制接口。監聽手機 APP 連線，接收十六進位協議指令。
* **Flask Web Server (Port 6500)**：提供網頁視圖，並透過 `/video_feed` 路由輸出 MJPEG 影像串流。
* **IP 自動獲取**：內建 `get_ip_address()` 函式，自動抓取 `eth0` 或 `wlan0` 的 IP 位址。

### 3.2 指令解析與動作控制
* **十六進位協議**：透過 `parse_data()` 解析 `$cmd#` 格式的指令。
* **運動控制**：包含平移 (move_x, move_y)、轉身 (turnleft/right) 與姿態調整 (attitude)。
* **預設動作組**：支援多種預設動作（如俯臥撐、伸懶腰、打招呼等）。
* **自穩系統 (IMU)**：支援開啟或關閉機器狗的姿態自我平衡功能。

### 3.3 狀態反饋機制
* **電池監測**：定期向客戶端回傳電池電壓資料。
* **系統狀態**：回傳目前的步態頻率、速度係數與身體高度。

## 四、 運作流程 (Main)
1.  **初始化**：啟動 `DOGZILLA()` 實例並設置初始電機速度。
2.  **開機自檢**：執行編號 `14` 的開機動作（通常是伸懶腰）。
3.  **平行任務**：
    * 啟動俯臥撐處理執行緒。
    * 啟動手柄掃描執行緒。
    * 檢查 OLED 服務狀態，若未啟動則手動開啟。
4.  **服務啟動**：開啟 TCP 監聽並啟動 WSGI Web 服務。